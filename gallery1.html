<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello World!</title>
    <script src="//unpkg.com/alpinejs" defer></script>
</head>
<body>
    <h1>Hello World!</h1>
    <canvas id="canvas" width="600" height="600"></canvas>
    <script> 
      // We will put our WebGL code here

     //vertices & index buffer

        const vertices = new Float32Array([
            0.0, 0.5, 0.0, // First vertex
            -0.5, -0.5, 0.0, // Second vertex
            0.5, -0.5, 0.0  // Third vertex
        ]);

        //const indices[] = {
        //    0, 1, 2,
        //    2, 3, 0
        //};

        const gl = document.getElementById("canvas").getContext("webgl");

        //declare shaders
        const vertexShader = `
            attribute vec4 position;
            void main() {
                gl_Position = position;
            }`;
            
        //gl_Position is output of vertex shader

        const fragmentShader = `
            precision mediump float;
            uniform vec4 color;
            void main() {
                gl_FragColor = color;
            }`;


        //compile shaders
        //shader source takes in string containing GLSL code

        const vs = gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vs, vertexShader);
        gl.compileShader(vs);

        const fs = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fs, fragmentShader);
        gl.compileShader(fs);

        //shaders must be compiled, and then linked to active gl program
        // Create and initialize the WebGL program
        const program = gl.createProgram();
        gl.attachShader(program, vs);
        gl.attachShader(program, fs);
        //shaders have been attached to program
        
        //https://docs.gl/gl4/glLinkProgram
        //linking vertex and shader functions to program
        gl.linkProgram(program);
        

        
        
        // Create the GPU array buffer with the vertices
        const buffer = gl.createBuffer();
        //bind buffer as current array buffer
        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);        


        // Shader attribute variable for position
        //matches position attribute in vertex shader
        const positionLocation = gl.getAttribLocation(program, "position");

        //attribute comes disabled
        //must enable it with the location
        gl.enableVertexAttribArray(positionLocation);
        
        //set pointer
        gl.vertexAttribPointer(
            positionLocation, // Target
            3,        // Chunk size (send the values 3 by 3)
            gl.FLOAT, // Type
            false,    // Normalize
            0,        // Stride
            0         // Offset
        );
        
        //https://docs.gl/gl4/glUseProgram
        //installs program into current rendering state
        //creates the executable program on the GPU
        gl.useProgram(program);        
        

        // Shader uniform variable for color (read-only)
        // attach js color variable to the color located instide the GLSL
        const colorLocation = gl.getUniformLocation(program, "color");

        // Set color        R  G  B  A
        // color in this case is 
        gl.uniform4f(colorLocation, 0, 1, 0, 1);

        // Set the clear color
        gl.clearColor(0.0, 0.0, 0.0, 1.0);

        // Clear canvas
        // clears out background
        gl.clear(gl.COLOR_BUFFER_BIT);

        // Render
        gl.drawArrays(
            gl.TRIANGLES, // Mode
            0,            // Start
            3             // Count
        );
                        // we have X elements in our array,
                        //when COUNT = 3
                        //that means we take 0 for x, 1 for y, 2 for z, then start overflow
                        //so (arraysize) / count = # of vertexes

    </script>
</body>
</html>